<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ | To-Do List</title>
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="To-Do List">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-TileColor" content="#4f46e5">
    <meta name="msapplication-config" content="./browserconfig.xml">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSIyNCIgZmlsbD0iIzRmNDZlNSIvPjxzdmcgeD0iNDUiIHk9IjQ1IiB3aWR0aD0iOTAiIGhlaWdodD0iOTAiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTguMjUgNi43NWg3LjVNOC4yNSAxMmg3LjVtLTcuNSA1LjI1aDcuNU0zLjc1IDYuNzVoLjAwN3YuMDA4SDMuNzVWNi43NVptLjM3NSAwYS4zNzUuMzc1IDAgMSAxLS43NSAwIC4zNzUuMzc1IDAgMCAxIC43NSAwWk0zLjc1IDEyaC4wMDd2LjAwOEgzLjc1VjEyWm0uMzc1IDBhLjM3NS4zNzUgMCAxIDEtLjc1IDAgLjM3NS4zNzUgMCAwIDEgLjc1IDBabS0uMzc1IDUuMjVoLjAwN3YuMDA4SDMuNzV2LS4wMDhabS4zNzUgMGEuMzc1LjM3NSAwIDEgMS0uNzUgMCAuMzc1LjM3NSAwIDAgMSAuNzUgMFoiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPjwvc3ZnPg==">
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI0IiBmaWxsPSIjNGY0NmU1Ii8+PHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI2ZmZmZmZiI+PHBhdGggZD0iTTguMjUgNi43NWg3LjVNOC4yNSAxMmg3LjVtLTcuNSA1LjI1aDcuNU0zLjc1IDYuNzVoLjAwN3YuMDA4SDMuNzVWNi43NVptLjM3NSAwYS4zNzUuMzc1IDAgMSAxLS43NSAwIC4zNzUuMzc1IDAgMCAxIC43NSAwWk0zLjc1IDEyaC4wMDd2LjAwOEgzLjc1VjEyWm0uMzc1IDBhLjM3NS4zNzUgMCAxIDEtLjc1IDAgLjM3NS4zNzUgMCAwIDEgLjc1IDBabS0uMzc1IDUuMjVoLjAwN3YuMDA4SDMuNzV2LS4wMDhabS4zNzUgMGEuMzc1LjM3NSAwIDEgMS0uNzUgMCAuMzc1LjM3NSAwIDAgMSAuNzUgMFoiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPjwvc3ZnPg==">
    
    <link rel="manifest" href="./manifest.json">
    
    <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô TailwindCSS v3 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ dark mode ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'thai': ['IBM Plex Sans Thai', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
        body {
            font-family: 'IBM Plex Sans Thai', sans-serif;
            -webkit-tap-highlight-color: transparent; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏ï‡∏∞‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        }

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡∏≤‡∏¢ SVG */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.07'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            z-index: -1;
            transition: opacity 0.3s ease-in-out;
        }

        .dark body::before {
            opacity: 0.5;
        }

        /* ‡∏ã‡πà‡∏≠‡∏ô scrollbar ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á scroll ‡πÑ‡∏î‡πâ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Transition ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö */
        .todo-item {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Skeleton Loading */
        .skeleton-item {
            background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        .dark .skeleton-item {
            background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ transition ‡∏Ç‡∏≠‡∏á‡∏ò‡∏µ‡∏° */
        html {
            transition: none !important;
        }
        
        html.dark {
            color-scheme: dark;
        }
        
        html:not(.dark) {
            color-scheme: light;
        }

        /* Login overlay styles */
        .login-overlay {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* PWA Install prompt styles */
        .install-prompt {
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
        }
        
        .install-prompt.show {
            transform: translateY(0);
        }

        /* Tooltip styles */
        .tooltip-container {
            position: relative;
        }
        
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            margin-bottom: 5px;
            z-index: 1000;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.8);
        }
        
        .tooltip-container:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Active theme button styles */
        .theme-btn.active,
        .theme-btn-mobile.active {
            background-color: white;
            color: #4f46e5;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .dark .theme-btn.active,
        .dark .theme-btn-mobile.active {
            background-color: #475569;
            color: #a855f7;
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 transition-colors duration-300">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 bg-black/50 login-overlay z-50 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 dark:text-slate-200">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ</h2>
                <p class="text-slate-500 dark:text-slate-400 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" required 
                           class="w-full bg-slate-100 dark:bg-slate-700 border-2 border-transparent focus:border-indigo-500 focus:ring-0 rounded-lg px-4 py-3 text-lg transition-colors duration-300" 
                           placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì...">
                </div>
                
                <!-- User Selection -->
                <div id="user-selection" class="hidden">
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏¥‡∏°</label>
                    <div id="existing-users" class="space-y-2"></div>
                </div>
                
                <button type="submit" 
                        class="w-full bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-all duration-300 transform hover:scale-105">
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
        </div>
    </div>

    <!-- Main App Content -->
    <div id="main-app" class="hidden">
        <!-- User Info Bar -->
        <div class="bg-white dark:bg-slate-800 shadow-sm border-b border-slate-200 dark:border-slate-700">
            <div class="container mx-auto max-w-2xl p-4">
                <!-- Desktop Layout -->
                <div class="hidden md:flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-slate-800 dark:text-slate-200">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="current-username"></span>!</p>
                            <p class="text-sm text-slate-500 dark:text-slate-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô: <span id="todo-count">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Theme Switcher -->
                        <div class="flex items-center space-x-1 bg-slate-100 dark:bg-slate-700 p-1 rounded-lg">
                            <button id="theme-light" class="theme-btn p-2 rounded-md hover:bg-white dark:hover:bg-slate-600 transition-all duration-200 tooltip-container">
                                <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                <span class="tooltip">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ß‡πà‡∏≤‡∏á</span>
                            </button>
                            <button id="theme-dark" class="theme-btn p-2 rounded-md hover:bg-white dark:hover:bg-slate-600 transition-all duration-200 tooltip-container">
                                <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                </svg>
                                <span class="tooltip">‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏î</span>
                            </button>
                            <button id="theme-system" class="theme-btn p-2 rounded-md hover:bg-white dark:hover:bg-slate-600 transition-all duration-200 tooltip-container">
                                <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                            <span class="tooltip">‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö</span>
                        </button>
                    </div>
                    <button id="logout-btn" class="text-slate-500 hover:text-red-500 dark:text-slate-400 dark:hover:text-red-400 transition-colors p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Layout -->
            <div class="md:hidden">
                <!-- First Row: User info and logout -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="font-medium text-slate-800 dark:text-slate-200 text-sm">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span id="current-username-mobile"></span>!</p>
                            <p class="text-xs text-slate-500 dark:text-slate-400">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô: <span id="todo-count-mobile">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        </div>
                    </div>
                    <button id="logout-btn-mobile" class="text-slate-500 hover:text-red-500 dark:text-slate-400 dark:hover:text-red-400 transition-colors p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Second Row: Theme switcher centered -->
                <div class="flex justify-center">
                    <div class="flex items-center space-x-1 bg-slate-100 dark:bg-slate-700 p-1 rounded-lg">
                        <button id="theme-light-mobile" class="theme-btn-mobile p-2 rounded-md hover:bg-white dark:hover:bg-slate-600 transition-all duration-200">
                            <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </button>
                        <button id="theme-dark-mobile" class="theme-btn-mobile p-2 rounded-md hover:bg-white dark:hover:bg-slate-600 transition-all duration-200">
                            <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                        </button>
                        <button id="theme-system-mobile" class="theme-btn-mobile p-2 rounded-md hover:bg-white dark:hover:bg-slate-600 transition-all duration-200">
                            <svg class="w-4 h-4 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
            </div>
        </div>

    <div class="container mx-auto max-w-2xl p-4 md:p-6">

        <!-- Header -->
        <header class="text-center my-8">
            <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-indigo-500 to-violet-600 dark:from-indigo-400 dark:to-violet-500 bg-clip-text text-transparent pb-2 pt-2">
                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥
            </h1>
            <p class="text-slate-500 dark:text-slate-400 mt-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏•‡∏∏‡∏•‡πà‡∏ß‡∏á</p>
        </header>

        <main class="space-y-6">
            <!-- Section ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà -->
            <section id="create-todo-card" class="bg-white dark:bg-slate-800/50 backdrop-blur-sm rounded-2xl shadow-lg p-6 transition-colors duration-300">
                <h2 class="text-xl font-semibold mb-4 text-slate-700 dark:text-slate-200">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
                <div class="flex flex-col gap-4">
                    <input type="text" id="todo-input" class="flex-grow bg-slate-100 dark:bg-slate-700 border-2 border-transparent focus:border-indigo-500 focus:ring-0 rounded-lg px-4 py-3 text-lg transition-colors duration-300" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥...">
                    <button id="add-todo-btn" class="bg-indigo-600 hover:bg-indigo-700 dark:bg-indigo-500 dark:hover:bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:scale-100">
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°
                    </button>
                </div>
            </section>

            <!-- Section ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì -->
            <section id="todos-list-card" class="bg-white dark:bg-slate-800/50 backdrop-blur-sm rounded-2xl shadow-lg p-6 transition-colors duration-300 min-h-[300px]">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-slate-700 dark:text-slate-200">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
                </div>

                <!-- Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á -->
                <div class="relative border-b-2 border-slate-200 dark:border-slate-700 mb-4">
                    <nav id="filter-tabs" class="flex space-x-4">
                        <button data-filter="all" class="filter-btn active py-2 px-3 font-medium text-indigo-600 dark:text-indigo-400 transition-colors duration-300">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <button data-filter="active" class="filter-btn py-2 px-3 font-medium text-slate-500 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-300">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</button>
                        <button data-filter="completed" class="filter-btn py-2 px-3 font-medium text-slate-500 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-300">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</button>
                    </nav>
                    <div id="tab-indicator" class="absolute bottom-[-2px] h-1 bg-indigo-500 rounded-full transition-all duration-300 ease-out"></div>
                </div>

                <!-- Skeleton Loading ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Initial Load -->
                <div id="initial-loader" class="space-y-3 mt-4">
                    <div class="bg-slate-100 dark:bg-slate-700 rounded-lg p-4 animate-pulse">
                        <div class="flex items-center gap-4">
                            <div class="h-6 w-6 rounded-full skeleton-item shrink-0"></div>
                            <div class="flex-grow space-y-2">
                                <div class="h-5 w-full rounded skeleton-item"></div>
                                <div class="h-3 w-1/3 rounded skeleton-item"></div>
                            </div>
                            <div class="h-6 w-6 rounded skeleton-item shrink-0"></div>
                        </div>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 rounded-lg p-4 animate-pulse">
                        <div class="flex items-center gap-4">
                            <div class="h-6 w-6 rounded-full skeleton-item shrink-0"></div>
                            <div class="flex-grow space-y-2">
                                <div class="h-5 w-4/5 rounded skeleton-item"></div>
                                <div class="h-3 w-1/4 rounded skeleton-item"></div>
                            </div>
                            <div class="h-6 w-6 rounded skeleton-item shrink-0"></div>
                        </div>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 rounded-lg p-4 animate-pulse">
                        <div class="flex items-center gap-4">
                            <div class="h-6 w-6 rounded-full skeleton-item shrink-0"></div>
                            <div class="flex-grow space-y-2">
                                <div class="h-5 w-3/5 rounded skeleton-item"></div>
                                <div class="h-3 w-1/5 rounded skeleton-item"></div>
                            </div>
                            <div class="h-6 w-6 rounded skeleton-item shrink-0"></div>
                        </div>
                    </div>
                </div>

                <!-- Container ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ To-Do -->
                <div id="todo-list-container" class="space-y-3 mt-4 overflow-y-auto max-h-[400px] no-scrollbar">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ To-Do ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </div>

                <!-- Empty States -->
                <div id="empty-state-all" class="empty-state hidden text-center py-10">
                    <div class="w-24 h-24 mx-auto text-slate-300 dark:text-slate-600">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h7.5M8.25 12h7.5m-7.5 5.25h7.5M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                        </svg>
                    </div>
                    <p class="mt-4 font-semibold text-slate-600 dark:text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                    <p class="text-sm text-slate-500 dark:text-slate-500">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
                </div>
                <div id="empty-state-active" class="empty-state hidden text-center py-10">
                     <div class="w-24 h-24 mx-auto text-slate-300 dark:text-slate-600">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                    </div>
                    <p class="mt-4 font-semibold text-slate-600 dark:text-slate-400">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</p>
                    <p class="text-sm text-slate-500 dark:text-slate-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                </div>
                <div id="empty-state-completed" class="empty-state hidden text-center py-10">
                    <div class="w-24 h-24 mx-auto text-slate-300 dark:text-slate-600">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full">
                           <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125" />
                         </svg>
                    </div>
                    <p class="mt-4 font-semibold text-slate-600 dark:text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à</p>
                    <p class="text-sm text-slate-500 dark:text-slate-500">‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Å‡∏±‡∏ô!</p>
                </div>
            </section>
        </main>
    </div>
    </div>

    <!-- PWA Install Prompt -->
    <div id="install-prompt" class="install-prompt fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 p-4 shadow-lg border-t border-slate-200 dark:border-slate-700 z-40">
        <div class="container mx-auto max-w-2xl flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                    </svg>
                </div>
                <div>
                    <p class="font-medium text-slate-800 dark:text-slate-200">‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</p>
                    <p class="text-sm text-slate-500 dark:text-slate-400">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <button id="install-dismiss" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 px-3 py-2 text-sm font-medium">
                    ‡πÑ‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß
                </button>
                <button id="install-app" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                    ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
                </button>
            </div>
        </div>
    </div>

    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM Elements ---
    const todoInput = document.getElementById('todo-input');
    const addTodoBtn = document.getElementById('add-todo-btn');
    const todoListContainer = document.getElementById('todo-list-container');
    const filterTabs = document.getElementById('filter-tabs');
    const tabIndicator = document.getElementById('tab-indicator');
    const initialLoader = document.getElementById('initial-loader');

    const themeLightBtn = document.getElementById('theme-light');
    const themeDarkBtn = document.getElementById('theme-dark');
    const themeSystemBtn = document.getElementById('theme-system');
    
    // Mobile theme buttons
    const themeLightBtnMobile = document.getElementById('theme-light-mobile');
    const themeDarkBtnMobile = document.getElementById('theme-dark-mobile');
    const themeSystemBtnMobile = document.getElementById('theme-system-mobile');
    
    const themeButtons = [themeLightBtn, themeDarkBtn, themeSystemBtn, themeLightBtnMobile, themeDarkBtnMobile, themeSystemBtnMobile];

    const emptyStates = {
        all: document.getElementById('empty-state-all'),
        active: document.getElementById('empty-state-active'),
        completed: document.getElementById('empty-state-completed')
    };

    // --- Login Elements ---
    const loginOverlay = document.getElementById('login-overlay');
    const mainApp = document.getElementById('main-app');
    const loginForm = document.getElementById('login-form');
    const usernameInput = document.getElementById('username');
    const userSelection = document.getElementById('user-selection');
    const existingUsers = document.getElementById('existing-users');
    const currentUsernameSpan = document.getElementById('current-username');
    const currentUsernameSpanMobile = document.getElementById('current-username-mobile');
    const todoCountSpan = document.getElementById('todo-count');
    const todoCountSpanMobile = document.getElementById('todo-count-mobile');
    const logoutBtn = document.getElementById('logout-btn');
    const logoutBtnMobile = document.getElementById('logout-btn-mobile');

    // --- PWA Elements ---
    const installPrompt = document.getElementById('install-prompt');
    const installBtn = document.getElementById('install-app');
    const installDismiss = document.getElementById('install-dismiss');

    // --- State ---
    let todos = [];
    let currentFilter = 'all';
    let currentUser = null;
    let deferredPrompt = null;

    // --- PWA Service Worker Registration ---
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(registration => {
                    console.log('‚úÖ Service Worker registered successfully:', registration.scope);
                })
                .catch(error => {
                    console.log('‚ùå Service Worker registration failed:', error);
                });
        });
    }

    // --- PWA Install Prompt ---
    window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üîß PWA: Install prompt available');
        e.preventDefault();
        deferredPrompt = e;
        
        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏õ‡∏¥‡∏î prompt ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
        if (!localStorage.getItem('pwa_install_dismissed') && !window.matchMedia('(display-mode: standalone)').matches) {
            setTimeout(() => {
                installPrompt.classList.add('show');
            }, 3000); // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        }
    });

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô PWA ‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß
    if (window.matchMedia('(display-mode: standalone)').matches) {
        console.log('‚úÖ PWA: Running in standalone mode');
        installPrompt.style.display = 'none';
    }

    installBtn.addEventListener('click', async () => {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`PWA install: ${outcome}`);
            if (outcome === 'accepted') {
                console.log('‚úÖ PWA: User accepted the install prompt');
                speakText('‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            }
            deferredPrompt = null;
        }
        installPrompt.classList.remove('show');
    });

    installDismiss.addEventListener('click', () => {
        localStorage.setItem('pwa_install_dismissed', 'true');
        installPrompt.classList.remove('show');
        speakText('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ');
    });

    // --- User Management ---
    function saveUser(username) {
        const users = JSON.parse(localStorage.getItem('todo_users') || '[]');
        if (!users.includes(username)) {
            users.push(username);
            localStorage.setItem('todo_users', JSON.stringify(users));
        }
        localStorage.setItem('current_user', username);
        currentUser = username;
    }

    function loadUsers() {
        return JSON.parse(localStorage.getItem('todo_users') || '[]');
    }

    function getCurrentUser() {
        return localStorage.getItem('current_user');
    }

    function renderExistingUsers() {
        const users = loadUsers();
        existingUsers.innerHTML = '';
        
        if (users.length > 0) {
            userSelection.classList.remove('hidden');
            users.forEach(user => {
                const userBtn = document.createElement('button');
                userBtn.type = 'button';
                userBtn.className = 'w-full text-left p-3 rounded-lg bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors';
                userBtn.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold">${user.charAt(0).toUpperCase()}</span>
                        </div>
                        <span class="text-slate-800 dark:text-slate-200">${user}</span>
                    </div>
                `;
                userBtn.addEventListener('click', () => {
                    usernameInput.value = user;
                    document.querySelectorAll('#existing-users button').forEach(btn => {
                        btn.classList.remove('ring-2', 'ring-indigo-500');
                    });
                    userBtn.classList.add('ring-2', 'ring-indigo-500');
                });
                existingUsers.appendChild(userBtn);
            });
        }
    }

    function login(username) {
        saveUser(username);
        currentUsernameSpan.textContent = username;
        currentUsernameSpanMobile.textContent = username;
        loginOverlay.classList.add('hidden');
        mainApp.classList.remove('hidden');
        
        // ‡πÅ‡∏™‡∏î‡∏á loader ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        initialLoader.style.display = 'block';
        todoListContainer.style.display = 'none';
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô loader
        setTimeout(() => {
            loadTodos();
            renderTodos();
            updateTodoCount();
            updateTabIndicator();
            initialLoader.style.display = 'none';
            todoListContainer.style.display = 'block';
        }, 500);
        
        speakText(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${username} ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏≠‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥`);
    }

    function logout() {
        localStorage.removeItem('current_user');
        currentUser = null;
        todos = [];
        loginOverlay.classList.remove('hidden');
        mainApp.classList.add('hidden');
        usernameInput.value = '';
        renderExistingUsers();
        speakText('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
    }

    function updateTodoCount() {
        const activeCount = todos.filter(todo => !todo.completed).length;
        const completedCount = todos.filter(todo => todo.completed).length;
        const countText = `${todos.length} (‡πÄ‡∏™‡∏£‡πá‡∏à: ${completedCount}, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${activeCount})`;
        todoCountSpan.textContent = countText;
        todoCountSpanMobile.textContent = todos.length;
    }

    // --- Initialization (‡πÄ‡∏û‡∏¥‡πà‡∏° debug logs) ---
    function initializeApp() {
        console.log('üöÄ Initializing app...');
        
        // ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏ò‡∏µ‡∏°‡∏Å‡πà‡∏≠‡∏ô
        loadAndApplyTheme();
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        const savedUser = getCurrentUser();
        if (savedUser) {
            currentUser = savedUser;
            currentUsernameSpan.textContent = savedUser;
            currentUsernameSpanMobile.textContent = savedUser;
            loginOverlay.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            // ‡πÅ‡∏™‡∏î‡∏á loader ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            initialLoader.style.display = 'block';
            todoListContainer.style.display = 'none';
            
            setTimeout(() => {
                loadTodos();
                renderTodos();
                updateTabIndicator();
                updateTodoCount();
                initialLoader.style.display = 'none';
                todoListContainer.style.display = 'block';
                console.log('‚úÖ App initialized successfully');
            }, 500);
        } else {
            // ‡∏ã‡πà‡∏≠‡∏ô loader ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login
            initialLoader.style.display = 'none';
            renderExistingUsers();
            loginOverlay.classList.remove('hidden');
            mainApp.classList.add('hidden');
        }
    }

    // --- Theme Management (COMPLETELY REWRITTEN) ---
    function applyTheme(theme) {
        const html = document.documentElement;
        const isSystemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        console.log('üé® Applying theme:', theme);
        console.log('üåô System is dark:', isSystemDark);

        // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏•‡∏ö class dark ‡∏Å‡πà‡∏≠‡∏ô
        html.classList.remove('dark');
        
        // ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° class dark (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ timing)
        setTimeout(() => {
            if (theme === 'dark') {
                html.classList.add('dark');
                console.log('‚úÖ Dark mode activated');
            } else if (theme === 'system' && isSystemDark) {
                html.classList.add('dark');
                console.log('‚úÖ System dark mode activated');
            } else {
                console.log('‚òÄÔ∏è Light mode activated');
            }
            
            console.log('üìã Final HTML classes:', html.classList.toString());
            updateThemeButtons(theme);
        }, 10);
    }
    
    function saveTheme(theme) { localStorage.setItem('todo_theme', theme); }

    function loadAndApplyTheme() {
        const savedTheme = localStorage.getItem('todo_theme') || 'system';
        applyTheme(savedTheme);
    }

    function updateThemeButtons(activeTheme) {
        console.log('üîÑ Updating theme buttons for:', activeTheme);
        
        // ‡∏•‡∏ö classes ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡∏õ‡∏∏‡πà‡∏°
        themeButtons.forEach(btn => {
            btn.classList.remove('active', 'bg-indigo-200', 'dark:bg-indigo-700', 'ring-2', 'ring-indigo-500', 'ring-offset-2', 'ring-offset-white', 'dark:ring-offset-slate-800');
        });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° classes ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà active
        let activeButtons = [];
        if (activeTheme === 'light') {
            activeButtons = [themeLightBtn, themeLightBtnMobile];
        } else if (activeTheme === 'dark') {
            activeButtons = [themeDarkBtn, themeDarkBtnMobile];
        } else if (activeTheme === 'system') {
            activeButtons = [themeSystemBtn, themeSystemBtnMobile];
        }
        
        activeButtons.forEach(btn => {
            if (btn) {
                btn.classList.add('active');
                console.log('‚úÖ Button styling applied to:', activeTheme);
            }
        });
    }
    
    // --- Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Theme (Desktop) ---
    themeLightBtn.addEventListener('click', () => { 
        console.log('üñ±Ô∏è Light button clicked');
        saveTheme('light'); 
        applyTheme('light'); 
    });
    
    themeDarkBtn.addEventListener('click', () => { 
        console.log('üñ±Ô∏è Dark button clicked');
        saveTheme('dark'); 
        applyTheme('dark'); 
    });
    
    themeSystemBtn.addEventListener('click', () => { 
        console.log('üñ±Ô∏è System button clicked');
        saveTheme('system'); 
        applyTheme('system'); 
    });

    // --- Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Theme (Mobile) ---
    themeLightBtnMobile.addEventListener('click', () => { 
        console.log('üñ±Ô∏è Light button (mobile) clicked');
        saveTheme('light'); 
        applyTheme('light'); 
    });
    
    themeDarkBtnMobile.addEventListener('click', () => { 
        console.log('üñ±Ô∏è Dark button (mobile) clicked');
        saveTheme('dark'); 
        applyTheme('dark'); 
    });
    
    themeSystemBtnMobile.addEventListener('click', () => { 
        console.log('üñ±Ô∏è System button (mobile) clicked');
        saveTheme('system'); 
        applyTheme('system'); 
    });
    
    // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ listener ‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
        const savedTheme = localStorage.getItem('todo_theme') || 'system';
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ò‡∏µ‡∏°‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô '‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö' ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
        if (savedTheme === 'system') {
            applyTheme('system');
        }
    });

    // --- To-Do Data Management ---
    function saveTodos() { 
        if (currentUser) {
            localStorage.setItem(`todos_${currentUser}`, JSON.stringify(todos)); 
        }
    }
    
    function loadTodos() {
        if (currentUser) {
            const savedTodos = localStorage.getItem(`todos_${currentUser}`);
            todos = savedTodos ? JSON.parse(savedTodos) : [];
        } else {
            todos = [];
        }
    }
    
    // --- Text to Speech ---
    function speakText(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'th-TH';
            utterance.pitch = 1;
            utterance.rate = 1; 
            window.speechSynthesis.speak(utterance);
        } else {
            console.log('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
        }
    }


    // --- Rendering ---
    function renderTodos() {
        todoListContainer.innerHTML = '';
        const filteredTodos = getFilteredTodos();
        if (filteredTodos.length === 0) {
            showEmptyState();
        } else {
            hideAllEmptyStates();
            filteredTodos.forEach(todo => {
                const todoElement = createTodoElement(todo);
                todoListContainer.appendChild(todoElement);
            });
        }
    }
    function getFilteredTodos() {
        switch (currentFilter) {
            case 'active': return todos.filter(todo => !todo.completed);
            case 'completed': return todos.filter(todo => todo.completed);
            default: return todos;
        }
    }
    function createTodoElement(todo) {
        const div = document.createElement('div');
        div.className = 'todo-item-wrapper relative';
        div.dataset.id = todo.id;
        const backgroundDiv = document.createElement('div');
        backgroundDiv.className = 'absolute inset-0 bg-red-500 rounded-lg flex items-center justify-end px-6 text-white';
        backgroundDiv.innerHTML = `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>`;
        const itemDiv = document.createElement('div');
        itemDiv.className = `todo-item bg-slate-100 dark:bg-slate-700 rounded-lg p-4 flex items-center gap-4 relative cursor-pointer select-none`;
        itemDiv.innerHTML = `
            <input type="checkbox" ${todo.completed ? 'checked' : ''} class="h-6 w-6 rounded-full border-2 border-slate-300 dark:border-slate-500 text-indigo-600 focus:ring-indigo-500 shrink-0">
            <div class="flex-grow">
                <p class="text-lg ${todo.completed ? 'line-through text-slate-400 dark:text-slate-500' : 'text-slate-800 dark:text-slate-200'}">${escapeHTML(todo.text)}</p>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">${getMetaText(todo)}</p>
            </div>
            <button class="delete-btn text-slate-400 hover:text-red-500 dark:hover:text-red-400 transition-colors p-1 shrink-0">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        `;
        div.appendChild(backgroundDiv);
        div.appendChild(itemDiv);
        addSwipeToDelete(div, itemDiv, todo.id);
        return div;
    }
    function getMetaText(todo) {
        const createdAt = new Date(todo.createdAt);
        const formattedDate = createdAt.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' });
        if (todo.completed && todo.completedAt) {
            const completedAt = new Date(todo.completedAt);
            const duration = completedAt - createdAt;
            return `‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${formattedDate} (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤: ${formatDuration(duration)})`;
        }
        return `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${formattedDate}`;
    }
    function formatDuration(ms) {
        if (ms < 0) ms = 0;
        const seconds = Math.floor((ms / 1000) % 60);
        const minutes = Math.floor((ms / (1000 * 60)) % 60);
        const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
        const days = Math.floor(ms / (1000 * 60 * 60 * 24));
        if (days > 0) return `${days} ‡∏ß‡∏±‡∏ô`;
        if (hours > 0) return `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
        if (minutes > 0) return `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
        return `${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    function formatDurationForSpeech(ms) {
        if (ms < 0) ms = 0;
        const seconds = Math.floor((ms / 1000) % 60);
        const minutes = Math.floor((ms / (1000 * 60)) % 60);
        const hours = Math.floor((ms / (1000 * 60 * 60)) % 24);
        const days = Math.floor(ms / (1000 * 60 * 60 * 24));
        
        if (days > 0) {
            return `${days} ‡∏ß‡∏±‡∏ô${hours > 0 ? ` ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á` : ''}`;
        }
        if (hours > 0) {
            return `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á${minutes > 0 ? ` ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ` : ''}`;
        }
        if (minutes > 0) {
            return `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ${seconds > 30 ? ` ${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ` : ''}`;
        }
        if (seconds < 5) {
            return '‡πÑ‡∏°‡πà‡∏Å‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ';
        }
        return `${seconds} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
    }

    // --- Event Handlers ---
    function handleAddTodo() {
        const text = todoInput.value.trim();
        if (text === '') return;
        addTodoBtn.disabled = true;
        const skeleton = document.createElement('div');
        skeleton.className = 'flex items-center space-x-4 p-4 animate-pulse';
        skeleton.innerHTML = `<div class="h-6 w-6 rounded-full skeleton-item"></div><div class="h-5 flex-1 rounded skeleton-item"></div>`;
        todoListContainer.prepend(skeleton);
        setTimeout(() => {
            skeleton.remove();
            const newTodo = { id: Date.now(), text: text, completed: false, createdAt: new Date().toISOString(), completedAt: null };
            todos.unshift(newTodo);
            saveTodos();
            renderTodos();
            todoInput.value = '';
            addTodoBtn.disabled = false;
            updateTodoCount();
            
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà
            speakText(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà "${text}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`);
        }, 2000);
    }
    function handleListClick(e) {
        const target = e.target;
        const itemWrapper = target.closest('.todo-item-wrapper');
        if (!itemWrapper) return;
        const id = Number(itemWrapper.dataset.id);
        if (target.closest('.delete-btn')) {
            deleteTodo(id, itemWrapper);
            return;
        }
        if (target.closest('.todo-item')) {
            toggleComplete(id);
        }
    }
    
    function toggleComplete(id) {
        const todo = todos.find(t => t.id === id);
        if (todo) {
            todo.completed = !todo.completed;
            if (todo.completed) {
                todo.completedAt = new Date().toISOString();
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ
                const createdAt = new Date(todo.createdAt);
                const completedAt = new Date(todo.completedAt);
                const duration = completedAt - createdAt;
                const durationText = formatDurationForSpeech(duration);
                
                // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
                speakText(`‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${todo.text}" ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤ ${durationText}`);
            } else {
                todo.completedAt = null;
                speakText(`‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${todo.text}"`);
            }
            saveTodos();
            renderTodos();
            updateTodoCount();
        }
    }
    
    function deleteTodo(id, element) {
        const todo = todos.find(t => t.id === id);
        const todoText = todo ? todo.text : '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
        
        element.style.transform = 'translateX(-100%)';
        element.style.opacity = '0';
        setTimeout(() => {
            todos = todos.filter(t => t.id !== id);
            saveTodos();
            renderTodos();
            updateTodoCount();
            
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            speakText(`‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "${todoText}" ‡πÅ‡∏•‡πâ‡∏ß`);
        }, 300);
    }
    function handleFilterClick(e) {
        const target = e.target.closest('.filter-btn');
        if (target) {
            currentFilter = target.dataset.filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active', 'text-indigo-600', 'dark:text-indigo-400');
                btn.classList.add('text-slate-500', 'dark:text-slate-400');
            });
            target.classList.add('active', 'text-indigo-600', 'dark:text-indigo-400');
            target.classList.remove('text-slate-500', 'dark:text-slate-400');
            updateTabIndicator();
            renderTodos();
        }
    }

    // --- UI/UX Enhancements ---
    function updateTabIndicator() {
        const activeButton = filterTabs.querySelector('.filter-btn.active');
        if (activeButton) {
            tabIndicator.style.width = `${activeButton.offsetWidth}px`;
            tabIndicator.style.left = `${activeButton.offsetLeft}px`;
        }
    }
    function showEmptyState() {
        hideAllEmptyStates();
        todoListContainer.innerHTML = '';
        if (emptyStates[currentFilter]) {
            emptyStates[currentFilter].classList.remove('hidden');
        }
    }
    function hideAllEmptyStates() {
        Object.values(emptyStates).forEach(el => el.classList.add('hidden'));
    }
    function addSwipeToDelete(wrapper, item, id) {
        let startX = 0, currentX = 0, isDragging = false;
        const threshold = -wrapper.offsetWidth * 0.4;
        const handleStart = (e) => {
            startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            isDragging = true;
            wrapper.style.transition = 'none';
        };
        const handleMove = (e) => {
            if (!isDragging) return;
            currentX = (e.type === 'touchmove' ? e.touches[0].clientX : e.clientX) - startX;
            if (currentX < 0) { item.style.transform = `translateX(${currentX}px)`; }
        };
        const handleEnd = () => {
            if (!isDragging) return;
            isDragging = false;
            item.style.transition = 'transform 0.3s ease-out';
            if (currentX < threshold) { deleteTodo(id, wrapper); } 
            else { item.style.transform = 'translateX(0px)'; }
        };
        item.addEventListener('mousedown', handleStart);
        item.addEventListener('touchstart', handleStart, { passive: true });
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('touchmove', handleMove, { passive: true });
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchend', handleEnd);
    }
    function escapeHTML(str) {
        return str.replace(/[&<>'"]/g, 
            tag => ({'&': '&amp;','<': '&lt;','>': '&gt;',"'": '&#39;','"': '&quot;'}[tag] || tag)
        );
    }

    // --- Event Listeners ---
    addTodoBtn.addEventListener('click', handleAddTodo);
    todoInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleAddTodo(); });
    todoListContainer.addEventListener('click', handleListClick);
    filterTabs.addEventListener('click', handleFilterClick);
    window.addEventListener('resize', updateTabIndicator);

    // --- Login Event Listeners ---
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const username = usernameInput.value.trim();
        if (username) {
            login(username);
        }
    });

    logoutBtn.addEventListener('click', logout);
    logoutBtnMobile.addEventListener('click', logout);

    // --- Start App ---
    initializeApp();
});
</script>

</body>
</html>
